From: Andy Dougherty <doughera@lafayette.edu>
Date: Thu, 27 Sep 2012 13:52:18 +0000 (-0400)
Subject: avoid calling memset with a negative count
X-Git-Tag: v5.14.3-RC2~3
X-Git-Url: http://perl5.git.perl.org/perl.git/commitdiff_plain/b675304e3fdbcce3ef853b06b6ebe870d99faa7e

avoid calling memset with a negative count

Poorly written perl code that allows an attacker to specify the count to
perl's 'x' string repeat operator can already cause a memory exhaustion
denial-of-service attack. A flaw in versions of perl before 5.15.5 can
escalate that into a heap buffer overrun; coupled with versions of glibc
before 2.16, it possibly allows the execution of arbitrary code.

The flaw addressed to this commit has been assigned identifier
CVE-2012-5195.

diff -Napur perl-5.10.1.orig/util.c perl-5.10.1/util.c
--- perl-5.10.1.orig/util.c	2009-08-15 09:36:34.000000000 -0700
+++ perl-5.10.1/util.c	2012-11-15 20:41:02.000000000 -0800
@@ -3075,6 +3075,9 @@ Perl_repeatcpy(pTHX_ register char *to,
 
     PERL_ARGS_ASSERT_REPEATCPY;
 
+    if (count < 0)
+       Perl_croak_nocontext("%s",PL_memory_wrap);
+
     if (len == 1) {
 	register const char c = *from;
 	while (count-- > 0)
